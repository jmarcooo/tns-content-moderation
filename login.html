<script>
        // 1. CLEAR OLD SESSION
        // CHANGED: Clear sessionStorage instead of localStorage
        sessionStorage.removeItem('currentUser'); 

        // 2. CHECK THEME (Keep localStorage for preferences like theme)
        const savedTheme = localStorage.getItem('appTheme') || 'light';
        if (savedTheme === 'dark') document.body.classList.add('dark-mode');

        // 3. LOGIN LOGIC (CONNECTED TO DB)
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const uInput = document.getElementById('username').value.trim();
            const pInput = document.getElementById('password').value.trim();
            const btn = document.getElementById('btn-login');
            const errorMsg = document.getElementById('error-msg');

            // Reset UI
            errorMsg.style.display = 'none';
            btn.innerText = "Verifying...";
            btn.disabled = true;

            try {
                // Fetch users from your Vercel API Route (Database)
                const response = await fetch('/api/users');
                
                if (!response.ok) {
                    throw new Error("Failed to connect to database.");
                }
                
                const users = await response.json();
                
                // Find matching user
                const user = users.find(u => u.username === uInput && u.password === pInput);

                if (user) {
                    // Success: Save user info (excluding password)
                    const safeUser = { ...user };
                    delete safeUser.password;
                    
                    // CHANGED: Use sessionStorage
                    sessionStorage.setItem('currentUser', JSON.stringify(safeUser));
                    window.location.href = 'home.html';
                } else {
                    // Fail
                    errorMsg.innerText = "❌ Invalid username or password";
                    errorMsg.style.display = 'block';
                    btn.innerText = "Sign In";
                    btn.disabled = false;
                }
            } catch (err) {
                console.error(err);
                errorMsg.innerText = "❌ Connection Error: " + err.message;
                errorMsg.style.display = 'block';
                btn.innerText = "Sign In";
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
