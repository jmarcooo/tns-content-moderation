<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Labelling Task (Fixed)</title>
    <link rel="stylesheet" href="style.css"> 
    <style>
        /* --- PAGE SPECIFIC CSS --- */
        .timer-badge { font-family: monospace; font-size: 1rem; letter-spacing: 1px; font-weight: bold; }
        .content-canvas { display: flex; flex-direction: column; height: 100%; overflow-y: auto; padding: 30px; }
        .labelling-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px; }
        
        .btn-label { 
            display: flex; align-items: center; justify-content: space-between; 
            padding: 15px 20px; background-color: var(--bg-body, #f4f6f8); 
            border: 1px solid var(--border-color, #e1e4e8); border-radius: 8px; 
            cursor: pointer; font-size: 0.95rem; font-weight: 600; 
            color: var(--text-muted, #57606a); transition: all 0.2s; text-align: left; 
        }
        .btn-label:hover { border-color: #0969da; background-color: #f1f8ff; color: #24292f; }
        .btn-label.selected { 
            background-color: rgba(9, 105, 218, 0.1); border-color: #0969da; 
            color: #0969da; box-shadow: 0 0 0 1px #0969da; 
        }

        .check-icon { width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .btn-label.selected .check-icon { border-color: #0969da; background-color: #0969da; }
        .check-icon svg { width: 12px; height: 12px; fill: white; display: none; }
        .btn-label.selected .check-icon svg { display: block; }
        
        .labelling-textarea { 
            width: 100%; padding: 12px; border: 1px solid #d0d7de; 
            border-radius: 6px; background-color: #ffffff; 
            color: #24292f; font-size: 0.9rem; resize: vertical; 
            min-height: 80px; outline: none; margin-top: 8px; 
        }
        .labelling-textarea:focus { border-color: #0969da; box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1); }
        .text-field-label { margin-bottom:4px; font-weight:bold; color:#24292f; font-size:0.85rem; }
    </style>
</head>
<body>

    <div id="sidebar-container"></div>

    <main class="main-content">
        <div class="header" style="margin-bottom: 20px; border-bottom: none; padding-bottom: 0;">
            <div>
                <a href="content-labelling.html" style="text-decoration: none; color: #57606a; font-size: 0.9rem;">← Back to Queue</a>
                <h1 id="queue-title" style="margin-top: 5px;">Video Labelling</h1>
            </div>
            <div style="display: flex; gap: 15px; align-items: center;">
                <span class="badge status-Active" style="font-size:0.9rem;">Session Time: <span id="timer" class="timer-badge">00:00:00</span></span>
                <span class="badge" style="background-color: #f6f8fa; border: 1px solid #d0d7de; color: #24292f; font-size:0.9rem;">
                    Labelled: <span id="session-counter" style="font-weight:bold;">0</span>
                </span>
            </div>
        </div>

        <div id="loader" style="display: flex; flex-direction:column; justify-content: center; align-items: center; height: 60vh; font-size: 1.2rem; color: #57606a;">
            <div id="loader-text">⚡ Fetching video...</div>
            <div id="error-log" style="color: red; font-size: 0.9rem; margin-top: 15px; display: none;"></div>
            <button onclick="window.location.reload()" style="margin-top: 15px; padding: 8px 16px; cursor: pointer; display: none;" id="retry-btn">Retry</button>
        </div>

        <div id="workbench" class="workbench-container" style="display: none; align-items: flex-start; gap: 24px;">
            
            <div class="left-sidebar" style="width: 320px; flex-shrink:0;">
                <div class="info-card">
                    <div class="info-header">Video Info</div>
                    <div class="info-row"><span class="label">Video ID:</span> <span class="value" id="info-id">--</span></div>
                    <div class="info-row"><span class="label">Duration:</span> <span class="value" id="info-duration">--</span></div>
                    <div class="info-row"><span class="label">Resolution:</span> <span class="value" id="info-res">1080p</span></div>
                </div>
                <div class="info-card">
                    <div class="info-header">Publisher Info</div>
                    <div class="info-row"><span class="label">Username:</span> <span class="value" id="info-user">--</span></div>
                    <div class="info-row"><span class="label">Followers:</span> <span class="value" id="info-followers">--</span></div>
                </div>
            </div>

            <div class="content-canvas" style="background-color: #ffffff; border: 1px solid #d0d7de; border-radius: 8px; flex-grow: 1;">
                
                <div id="module-content">
                    <div class="section-header">VIDEO CONTENT</div>
                    <div style="background:black; border-radius:8px; overflow:hidden; aspect-ratio:16/9; box-shadow:0 4px 12px rgba(0,0,0,0.2);">
                        <video id="main-video" controls style="width:100%; height:100%; display:block;"></video>
                    </div>
                </div>

                <div id="module-text" style="margin-top: 30px;">
                    <div class="section-header">CONTEXT</div>
                    <div style="margin-bottom: 15px;">
                        <div class="text-field-label">Video Title</div>
                        <div id="text-top" style="padding: 10px; background: #f6f8fa; border-radius: 6px;"></div>
                    </div>
                    <div>
                        <div class="text-field-label">Description</div>
                        <div id="text-bottom" style="padding: 10px; background: #f6f8fa; border-radius: 6px;"></div>
                    </div>
                </div>

                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid #d0d7de;">
                    <div class="section-header">CATEGORIZATION</div>
                    <div style="font-size: 0.85rem; color: #57606a; margin-bottom: 10px;">Select the primary category.</div>
                    
                    <div class="labelling-grid">
                        <button class="btn-label" onclick="VideoApp.selectLabel(this, 'high_qual')">
                            <span>High Quality</span><div class="check-icon">✓</div>
                        </button>
                        <button class="btn-label" onclick="VideoApp.selectLabel(this, 'education')">
                            <span>Education</span><div class="check-icon">✓</div>
                        </button>
                        <button class="btn-label" onclick="VideoApp.selectLabel(this, 'entertainment')">
                            <span>Entertainment</span><div class="check-icon">✓</div>
                        </button>
                        <button class="btn-label" onclick="VideoApp.selectLabel(this, 'news')">
                            <span>News</span><div class="check-icon">✓</div>
                        </button>
                    </div>

                    <div style="margin-top: 20px;">
                        <label class="text-field-label">Remarks</label>
                        <textarea id="remarks" class="labelling-textarea" placeholder="Optional notes..."></textarea>
                    </div>
                </div>

                <div style="margin-top: 30px; border-top: 1px solid #d0d7de; padding-top: 20px; text-align: right;">
                    <button onclick="VideoApp.loadNext()" style="padding: 10px 20px; background: white; border: 1px solid #d0d7de; border-radius: 6px; cursor: pointer; margin-right: 10px;">Skip</button>
                    <button onclick="VideoApp.submit()" style="padding: 10px 20px; background: #2da44e; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;">Submit</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- 1. SAFE SIDEBAR LOADER ---
        // Tries to load sidebar, but doesn't crash if missing
        try {
            const script = document.createElement('script');
            script.src = 'sidebar.js';
            script.onerror = () => console.warn("Sidebar.js not found, skipping.");
            document.head.appendChild(script);
        } catch(e) { console.log("Sidebar skipped"); }

        // --- 2. MAIN APPLICATION LOGIC ---
        const VideoApp = {
            selectedLabel: null,
            timer: 0,
            count: 0,
            
            init() {
                console.log("App Initializing...");
                // Force UI to show after 2 seconds even if video fails
                setTimeout(() => {
                    if(document.getElementById('loader').style.display !== 'none') {
                        this.showUI();
                        console.warn("Forced UI Load");
                    }
                }, 2000);

                this.loadNext();
                setInterval(() => {
                    this.timer++;
                    const d = new Date(null); d.setSeconds(this.timer);
                    document.getElementById('timer').innerText = d.toISOString().substr(11, 8);
                }, 1000);
            },

            loadNext() {
                // Show Loader
                document.getElementById('loader').style.display = 'flex';
                document.getElementById('workbench').style.display = 'none';

                // Reset Inputs
                this.selectedLabel = null;
                document.querySelectorAll('.btn-label').forEach(b => b.classList.remove('selected'));
                document.getElementById('remarks').value = '';

                // Fake Data Generation
                const id = Math.floor(Math.random() * 888888) + 111111;
                
                // DATA BINDING
                document.getElementById('info-id').innerText = id;
                document.getElementById('info-duration').innerText = "00:45";
                document.getElementById('info-user').innerText = "Demo_User_" + Math.floor(Math.random()*100);
                document.getElementById('info-followers').innerText = Math.floor(Math.random()*50000);
                
                document.getElementById('text-top').innerText = "Sample Video Title " + id;
                document.getElementById('text-bottom').innerText = "This is a test description for the video labelling task.";

                // VIDEO SOURCE (Using reliable Wikimedia source to avoid Google Cloud CORS issues)
                const vid = document.getElementById('main-video');
                vid.src = "https://upload.wikimedia.org/wikipedia/commons/transcoded/c/c0/Big_Buck_Bunny_4K.webm/Big_Buck_Bunny_4K.webm.480p.vp9.webm";
                
                // Simulate Network Delay then Show
                setTimeout(() => this.showUI(), 800);
            },

            showUI() {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('workbench').style.display = 'flex';
            },

            selectLabel(btn, label) {
                document.querySelectorAll('.btn-label').forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                this.selectedLabel = label;
            },

            submit() {
                if(!this.selectedLabel) { alert("Please select a category"); return; }
                this.count++;
                document.getElementById('session-counter').innerText = this.count;
                this.loadNext();
            }
        };

        // Start App immediately
        window.addEventListener('DOMContentLoaded', () => VideoApp.init());

        // Global Error Trap
        window.onerror = function(msg, source, line) {
            const errBox = document.getElementById('error-log');
            const loaderText = document.getElementById('loader-text');
            const retryBtn = document.getElementById('retry-btn');
            
            if(errBox && loaderText) {
                loaderText.innerText = "⚠️ Critical Error";
                errBox.style.display = 'block';
                errBox.innerText = `Error: ${msg}\nLine: ${line}`;
                retryBtn.style.display = 'block';
            }
        };
    </script>
</body>
</html>
