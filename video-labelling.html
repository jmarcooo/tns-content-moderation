<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Labelling Task</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .timer-badge { font-family: monospace; font-size: 1rem; letter-spacing: 1px; font-weight: bold; }
        .content-canvas { display: flex; flex-direction: column; height: 100%; overflow-y: auto; padding: 30px; }
        .labelling-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-top: 15px; }
        .btn-label { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; background-color: var(--bg-body); border: 1px solid var(--border-color); border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 600; color: var(--text-muted); transition: all 0.2s; text-align: left; }
        .btn-label:hover { border-color: var(--accent-blue); background-color: var(--hover-bg); color: var(--text-header); }
        .btn-label.selected { background-color: rgba(9, 105, 218, 0.1); border-color: var(--accent-blue); color: var(--accent-blue); box-shadow: 0 0 0 1px var(--accent-blue); }
        .check-icon { width: 20px; height: 20px; border: 2px solid #ccc; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .btn-label.selected .check-icon { border-color: var(--accent-blue); background-color: var(--accent-blue); }
        .check-icon svg { width: 12px; height: 12px; fill: white; display: none; }
        .btn-label.selected .check-icon svg { display: block; }
        .labelling-textarea { width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 6px; background-color: var(--bg-input); color: var(--text-main); font-size: 0.9rem; resize: vertical; min-height: 80px; outline: none; margin-top: 8px; }
        .labelling-textarea:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1); }
        .text-field-label { margin-bottom:4px; font-weight:bold; color:var(--text-header); font-size:0.85rem; }
    </style>
</head>
<body>

    <script src="sidebar.js"></script>

    <main class="main-content">
        
        <div class="header" style="margin-bottom: 20px; border-bottom: none; padding-bottom: 0;">
            <div>
                <a href="content-labelling.html" style="text-decoration: none; color: var(--text-muted); font-size: 0.9rem;">← Back to Queue</a>
                <h1 id="queue-title" style="margin-top: 5px;">Video Labelling</h1>
            </div>
            
            <div style="display: flex; gap: 15px; align-items: center;">
                <span class="badge status-Active" style="font-size:0.9rem;">Session Time: <span id="timer" class="timer-badge">00:00:00</span></span>
                <span class="badge" style="background-color: var(--hover-bg); border: 1px solid var(--border-color); color: var(--text-main); font-size:0.9rem;">
                    Labelled: <span id="session-counter" style="font-weight:bold;">0</span>
                </span>
            </div>
        </div>

        <div id="loader" style="display: flex; flex-direction:column; justify-content: center; align-items: center; height: 60vh; font-size: 1.2rem; color: var(--text-muted);">
            <div id="loader-msg">⚡ Fetching video...</div>
            <button id="retry-btn" onclick="window.location.reload()" style="display:none; margin-top:20px; padding:10px 20px; cursor:pointer;">Reload Page</button>
            <div id="debug-error" style="color:red; font-size:0.9rem; margin-top:10px; max-width:600px;"></div>
        </div>

        <div id="workbench" class="workbench-container" style="display: none; align-items: flex-start; gap: 24px;">
            
            <div class="left-sidebar" style="width: 320px; flex-shrink:0;">
                <div class="info-card">
                    <div class="info-header">Video Info</div>
                    <div class="info-row"><span class="label">Video ID:</span> <span class="value" id="info-id">--</span></div>
                    <div class="info-row"><span class="label">Duration:</span> <span class="value" id="info-duration">--</span></div>
                    <div class="info-row"><span class="label">Resolution:</span> <span class="value" id="info-res">1080p</span></div>
                </div>

                <div class="info-card">
                    <div class="info-header">Publisher Info</div>
                    <div class="info-row"><span class="label">Username:</span> <span class="value" id="info-user">--</span></div>
                    <div class="info-row"><span class="label">Followers:</span> <span class="value" id="info-followers">--</span></div>
                    <div class="info-row"><span class="label">Account Score:</span> <span class="value" id="info-score" style="color:#238636">High</span></div>
                </div>
            </div>

            <div class="content-canvas" style="background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px;">
                
                <div id="module-content">
                    <div class="section-header">VIDEO CONTENT</div>
                    <div style="background:black; border-radius:8px; overflow:hidden; aspect-ratio:16/9; box-shadow:0 4px 12px rgba(0,0,0,0.2);">
                        <video id="main-video" controls style="width:100%; height:100%; display:block;"></video>
                    </div>
                </div>

                <div id="module-text" style="margin-top: 30px;">
                    <div class="section-header">CONTEXT</div>
                    <div id="text-wrapper-top" style="margin-bottom: 15px;">
                        <div class="text-field-label">Video Title</div>
                        <div id="text-top" class="text-context-box"></div>
                    </div>
                    <div id="text-wrapper-bottom">
                        <div class="text-field-label">Description</div>
                        <div id="text-bottom" class="text-context-box"></div>
                    </div>
                </div>

                <div style="margin-top: 40px; padding-top: 20px; border-top: 1px solid var(--border-color);">
                    <div class="section-header">VIDEO CATEGORIZATION</div>
                    <div style="font-size: 0.85rem; color: var(--text-muted); margin-bottom: 10px;">Select the primary category for this video.</div>
                    
                    <div class="labelling-grid">
                        <button class="btn-label" onclick="VideoLabelApp.toggleLabel(this, 'high_quality')">
                            <span>High Production Quality</span>
                            <div class="check-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        </button>
                        <button class="btn-label" onclick="VideoLabelApp.toggleLabel(this, 'edu_content')">
                            <span>Educational / Tutorial</span>
                            <div class="check-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        </button>
                        <button class="btn-label" onclick="VideoLabelApp.toggleLabel(this, 'entertainment')">
                            <span>Entertainment / Vlog</span>
                            <div class="check-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        </button>
                        <button class="btn-label" onclick="VideoLabelApp.toggleLabel(this, 'news_politics')">
                            <span>News & Politics</span>
                            <div class="check-icon"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
                        </button>
                    </div>

                    <div style="margin-top: 20px;">
                        <label for="labelling-remarks" style="display:block; font-weight:600; color:var(--text-header); font-size:0.85rem; margin-bottom: 6px;">Remarks (Optional)</label>
                        <textarea id="labelling-remarks" class="labelling-textarea" placeholder="Add notes about video quality..."></textarea>
                    </div>
                </div>

                <div class="action-module" style="margin-top: auto; padding-top: 30px; border-top: 1px solid var(--border-color); display: flex; align-items: center; justify-content: flex-end; gap: 15px;">
                    <button class="btn-cancel" onclick="VideoLabelApp.skipTask()">Skip</button>
                    <button class="btn-primary" onclick="VideoLabelApp.submitLabels()">Submit Labels</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        window.onerror = function(msg, url, line) {
            document.getElementById('loader-msg').innerText = "⚠️ Script Error Detected";
            document.getElementById('debug-error').innerText = msg + " (Line " + line + ")";
            document.getElementById('retry-btn').style.display = 'block';
        };
        // Failsafe: If loader is still there after 5 seconds, show retry
        setTimeout(function() {
            if(document.getElementById('loader').style.display !== 'none') {
                document.getElementById('loader-msg').innerText = "⚠️ Loading Timed Out";
                document.getElementById('retry-btn').style.display = 'block';
            }
        }, 5000);
    </script>

    <script src="config.js" defer></script>
    <script src="auth.js" defer></script>
    <script src="video-labelling-logic.js" defer></script>
</body>
</html>
