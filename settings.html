<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Layout specific for Settings Items */
        .settings-container { background-color: var(--bg-card); border: 1px solid var(--border-color); border-radius: 8px; padding: 24px; box-shadow: var(--shadow); }
        .settings-section { padding-bottom: 24px; margin-bottom: 24px; border-bottom: 1px solid var(--border-color); }
        .settings-section:last-child { border-bottom: none; margin-bottom: 0; }
        .section-title { font-size: 1.1rem; font-weight: bold; color: var(--text-header); margin-bottom: 12px; }
        .settings-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .setting-label { font-weight: 600; color: var(--text-header); font-size: 0.95rem; margin-bottom: 4px; }
        .setting-desc { color: var(--text-muted); font-size: 0.85rem; }
        .key-input { width: 140px; padding: 8px; text-align: center; border: 1px solid var(--border-color); border-radius: 6px; background: var(--bg-input); color: var(--text-main); font-weight: bold; cursor: pointer; transition: all 0.2s; }
        .key-input:focus { border-color: var(--accent-blue); box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1); outline: none; background: var(--hover-bg); }
        .key-input.active-bind { border-color: #238636; background-color: rgba(35, 134, 54, 0.1); transform: scale(1.05); }
    </style>
</head>
<body>
    <script src="sidebar.js"></script>
    <main class="main-content">
        <div class="header"><h1 id="txt-header">Settings</h1></div>
        
        <div class="settings-container">
            
            <div class="settings-section">
                <div class="section-title" id="txt-appear-title">Appearance</div>
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="txt-dark-mode">Dark Mode</div>
                        <div class="setting-desc" id="txt-dark-desc">Adjust the appearance to reduce eye strain.</div>
                    </div>
                    <button class="btn-cancel" id="btn-theme-toggle" onclick="window.toggleTheme()">Switch to Dark Mode</button>
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title" id="txt-lang-title">Language / 语言</div>
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="txt-lang-label">Interface Language</div>
                        <div class="setting-desc" id="txt-lang-desc">Select your preferred language.</div>
                    </div>
                    <select id="langSelect" class="form-group" style="width: auto; margin-bottom: 0;" onchange="changeLanguage(this.value)">
                        <option value="en">English</option>
                        <option value="zh">中文 (Chinese)</option>
                    </select>
                </div>
            </div>

            <div class="settings-section">
                <div class="section-title" id="txt-kb-header">Keyboard Shortcuts</div>
                
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="lbl-kb-app-cont">Approve Content</div>
                        <div class="setting-desc" id="desc-kb-app-cont">Key to approve the main content (Image/Video).</div>
                    </div>
                    <input type="text" class="key-input" id="bind-approve-content" readonly>
                </div>
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="lbl-kb-rej-cont">Reject Content</div>
                        <div class="setting-desc" id="desc-kb-rej-cont">Key to reject the main content.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-reject-content" readonly>
                </div>

                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="lbl-kb-app-text">Approve Text</div>
                        <div class="setting-desc" id="desc-kb-app-text">Key to approve text/caption.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-approve-text" readonly>
                </div>
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="lbl-kb-rej-text">Reject Text</div>
                        <div class="setting-desc" id="desc-kb-rej-text">Key to reject text/caption.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-reject-text" readonly>
                </div>

                <div class="settings-row" style="border-top: 1px dashed var(--border-color); padding-top: 15px; margin-top: 15px;">
                    <div>
                        <div class="setting-label" id="lbl-kb-app-all">Approve All</div>
                        <div class="setting-desc" id="desc-kb-app-all">Approve both content and text simultaneously.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-approve-all" readonly>
                </div>
                <div class="settings-row">
                    <div>
                        <div class="setting-label" id="lbl-kb-rej-all">Reject All</div>
                        <div class="setting-desc" id="desc-kb-rej-all">Reject both content and text simultaneously.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-reject-all" readonly>
                </div>

                <div class="settings-row" style="margin-top: 15px;">
                    <div>
                        <div class="setting-label" id="lbl-kb-next">Submit & Next</div>
                        <div class="setting-desc" id="desc-kb-next">Submit decision and load next task.</div>
                    </div>
                    <input type="text" class="key-input" id="bind-next" readonly>
                </div>

                <div style="margin-top: 15px; display:flex; justify-content:flex-end;">
                     <button class="btn-primary" id="btn-save-shortcuts" onclick="saveKeybinds()">Save Shortcuts</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- 1. TRANSLATION & THEME LOGIC ---
        const APP_LANG_SET = localStorage.getItem('appLang') || 'en';
        const TEXT = {
            en: { 
                header: "Settings", appearTitle: "Appearance", darkMode: "Dark Mode", darkDesc: "Adjust the appearance to reduce eye strain.", btnDark: "Switch to Dark Mode", btnLight: "Switch to Light Mode", langTitle: "Language / 语言", langLabel: "Interface Language", langDesc: "Select your preferred language.",
                kbHeader: "Keyboard Shortcuts",
                kbAppCont: "Approve Content", kbAppContDesc: "Key to approve the main content (Image/Video).",
                kbRejCont: "Reject Content", kbRejContDesc: "Key to reject the main content.",
                kbAppText: "Approve Text", kbAppTextDesc: "Key to approve text/caption.",
                kbRejText: "Reject Text", kbRejTextDesc: "Key to reject text/caption.",
                kbAppAll: "Approve All", kbAppAllDesc: "Approve both content and text simultaneously.",
                kbRejAll: "Reject All", kbRejAllDesc: "Reject both content and text simultaneously.",
                kbNext: "Submit & Next", kbNextDesc: "Submit decision and load next task.",
                btnSave: "Save Shortcuts"
            },
            zh: { 
                header: "设置", appearTitle: "外观", darkMode: "深色模式", darkDesc: "调整外观以减少眼睛疲劳。", btnDark: "切换到深色模式", btnLight: "切换到浅色模式", langTitle: "语言 / Language", langLabel: "界面语言", langDesc: "选择您的首选语言。",
                kbHeader: "键盘快捷键",
                kbAppCont: "通过内容", kbAppContDesc: "批准主要内容（图片/视频）的按键。",
                kbRejCont: "拒绝内容", kbRejContDesc: "拒绝主要内容的按键。",
                kbAppText: "通过文本", kbAppTextDesc: "批准文本/标题的按键。",
                kbRejText: "拒绝文本", kbRejTextDesc: "拒绝文本/标题的按键。",
                kbAppAll: "全部通过", kbAppAllDesc: "同时批准内容和文本。",
                kbRejAll: "全部拒绝", kbRejAllDesc: "同时拒绝内容和文本。",
                kbNext: "提交并继续", kbNextDesc: "提交决定并加载下一个任务。",
                btnSave: "保存快捷键"
            }
        };
        const T_SET = TEXT[APP_LANG_SET];

        // Apply Translations
        const ids = {
            'txt-header': T_SET.header, 'txt-appear-title': T_SET.appearTitle, 'txt-dark-mode': T_SET.darkMode, 'txt-dark-desc': T_SET.darkDesc, 'txt-lang-title': T_SET.langTitle, 'txt-lang-label': T_SET.langLabel, 'txt-lang-desc': T_SET.langDesc,
            'txt-kb-header': T_SET.kbHeader,
            'lbl-kb-app-cont': T_SET.kbAppCont, 'desc-kb-app-cont': T_SET.kbAppContDesc,
            'lbl-kb-rej-cont': T_SET.kbRejCont, 'desc-kb-rej-cont': T_SET.kbRejContDesc,
            'lbl-kb-app-text': T_SET.kbAppText, 'desc-kb-app-text': T_SET.kbAppTextDesc,
            'lbl-kb-rej-text': T_SET.kbRejText, 'desc-kb-rej-text': T_SET.kbRejTextDesc,
            'lbl-kb-app-all': T_SET.kbAppAll, 'desc-kb-app-all': T_SET.kbAppAllDesc,
            'lbl-kb-rej-all': T_SET.kbRejAll, 'desc-kb-rej-all': T_SET.kbRejAllDesc,
            'lbl-kb-next': T_SET.kbNext, 'desc-kb-next': T_SET.kbNextDesc,
            'btn-save-shortcuts': T_SET.btnSave
        };

        for (const [id, text] of Object.entries(ids)) {
            const el = document.getElementById(id);
            if(el) el.innerText = text;
        }

        // Theme Button Logic
        function updateThemeButtonText() {
            const isDark = document.body.classList.contains('dark-mode');
            const btn = document.getElementById('btn-theme-toggle');
            if(btn) btn.innerText = isDark ? T_SET.btnLight : T_SET.btnDark;
        }
        
        // Init & Listen for global event from sidebar.js
        setTimeout(updateThemeButtonText, 50); 
        window.addEventListener('themeChanged', updateThemeButtonText);

        document.getElementById('langSelect').value = APP_LANG_SET;
        function changeLanguage(lang) {
            localStorage.setItem('appLang', lang);
            location.reload(); 
        }

        // --- 2. SHORTCUTS LOGIC ---
        const defaultBinds = { 
            'approve-content': '1', 
            'reject-content': '2', 
            'approve-text': '3', 
            'reject-text': '4', 
            'approve-all': 'Ctrl+1', 
            'reject-all': 'Ctrl+2', 
            'next': 'Enter' 
        };
        
        const saved = JSON.parse(localStorage.getItem('appKeybinds')) || {};
        const currentBinds = { ...defaultBinds, ...saved };

        const bindIds = [
            'approve-content', 'reject-content', 
            'approve-text', 'reject-text', 
            'approve-all', 'reject-all', 
            'next'
        ];

        bindIds.forEach(key => {
            const el = document.getElementById(`bind-${key}`);
            if(el) {
                el.value = currentBinds[key] || '';
                
                el.addEventListener('keydown', (e) => {
                    e.preventDefault();
                    e.stopPropagation();
                    if (['Control', 'Alt', 'Shift', 'Meta'].includes(e.key)) return;

                    let keys = [];
                    if (e.ctrlKey) keys.push('Ctrl');
                    if (e.altKey) keys.push('Alt');
                    if (e.shiftKey) keys.push('Shift');
                    if (e.metaKey) keys.push('Meta');
                    
                    let char = e.key;
                    if (char === ' ') char = 'Space';
                    if (char.length === 1) char = char.toUpperCase();
                    
                    keys.push(char);
                    const keyString = keys.join('+');
                    
                    el.value = keyString;
                    el.classList.add('active-bind');
                    setTimeout(() => el.classList.remove('active-bind'), 200);
                });
            }
        });

        function saveKeybinds() { 
            const newBinds = {};
            bindIds.forEach(key => {
                const el = document.getElementById(`bind-${key}`);
                if(el) newBinds[key] = el.value;
            });
            localStorage.setItem('appKeybinds', JSON.stringify(newBinds));
            alert(APP_LANG_SET === 'zh' ? '快捷键已保存！' : 'Shortcuts Saved!'); 
        }
    </script>
</body>
</html>
